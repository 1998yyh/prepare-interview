# 源码部分学习

## 虚拟DOM与diff算法

1. patch函数：用于处理新旧节点的函数；
+ 先判断旧节点是DOM节点还是虚拟节点，如果是DOM节点就需要包装成虚拟节点
+ 判断新旧节点是不是同一个节点（指tag和key），如果不是，删除旧的节点，添加新的节点。
+ 如果是同一个节点，判读新旧节点是否是同一个节点（指在内存中，即oldVnode === newVnode)，如果是则不做操作
+ 如果不是则需要判断新节点是否有text属性，如果有，判断旧节点text与新节点text是否相同，如果相同则不操作，不相同则覆盖。
+ 如果新节点没有text属性，意味着有children属性，然后就看old里面有没有children属性
+ 如果old里面又children属性，要做精细化比较即diff算法
+ 如果old里面没有children属性，则删除文本，添加children到dom中


2.diff算法():
1. 4个指针，新节点前指针，新节点后指针，旧节点前指针，旧节点后指针。
2. 4种命中方式（从前往后测试命中）如果都没有命中就循环：
 + 1.新前与旧前
 + 2.新后与旧后
 + 3.新后与旧前（此种命中，涉及移动节点，那么旧前指向的节点，移动到旧后之后）
 + 4.新前与旧后（此种命中，涉及移动节点，那么旧后指向的节点，移动到旧前之前）
 3.4 命中后，移动dom的节点变为undefined，在循环开始判断undefined 跳过。
3. 退出循环之后比较，新前与新后的大小判断是否又新节点添加，判断旧前与旧后的大小判断是否有旧节点删除。

3.vnode函数：
提取出key值，并将传入的参数封装成obj返回出去

4.h函数：
将ast对象封装成vnode对象，